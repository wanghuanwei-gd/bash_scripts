# 1 Create bed file for subset of genes (UCSC Table Browser)
# 2 GATK SelectVariant
# GATK SelectVariants

java -Xmx2g -jar software/GenomeAnalysisTK.jar \
   -R resources/ucsc.hg19.fasta \
   -T SelectVariants \
   --variant NIH-Schizophrenia/42010/PhenoGenotypeFiles/RootStudyConsentSet_phs000473.SchizophreniaSwedish_Sklar.v1.p1.c1.GRU/GenotypeFiles/scz-only-exome-all-nozeros-corrected-header.vcf \
   -o NIH-Schizophrenia/scz_swedish_subset_lit.vcf  \
   -L NIH-Schizophrenia/gene_subset.bed

# 3 Annotate VCF
software/annovar/table_annovar.pl NIH-Schizophrenia/gene_subset.vcf software/annovar/humandb/ \
	-buildver hg19 -out NIH-Schizophrenia/gene_subset.vcf -remove \
	-protocol refGene,esp6500siv2_all,esp6500siv2_ea,esp6500siv2_aa,1000g2014oct_all,1000g2014oct_afr,1000g2014oct_eur,exac02_ExAC,exac02_FIN,exac02_NFE,exac02_AMR,snp132 -operation g,f,f,f,f,f,f,f,f,f,f,f -nastring . -vcfinput

# 4 Load into PSEQ
# Create new project
pseq proj_name new-proj --resources /hg19
# load VCF
pseq proj_name load-vcf --vcf annotated_gene_subset.vcf
# load phenotype file
pseq proj_name load-pheno --file scz.phe
# Run gene based association tests (frequencies x<0.01,0.01<x<=0.05, x<=0.05)
pseq proj_name assoc --phenotype scz --mask loc.group=refseq mac=1-100 meta.req='1000g2014oct_all':lt:0.01 include="ExonicFunc.refGene == 'stopgain' ||  ExonicFunc.refGene == 'stoploss' || ExonicFunc.refGene == 'frameshift_deletion' || ExonicFunc.refGene == 'frameshift_insertion' || ExonicFunc.refGene == 'nonsynonymous_SNV'" --tests burden uniq vt calpha sumstat > assoc_tests/assoc_tests_mac100_le1.txt &
pseq proj_name assoc --phenotype scz --mask loc.group=refseq mac=1-100 meta.req='1000g2014oct_all':ge:0.01,'1000g2014oct_all':le:0.05 include="ExonicFunc.refGene == 'stopgain' ||  ExonicFunc.refGene == 'stoploss' || ExonicFunc.refGene == 'frameshift_deletion' || ExonicFunc.refGene == 'frameshift_insertion' || ExonicFunc.refGene == 'nonsynonymous_SNV'" --tests burden uniq vt calpha sumstat > assoc_tests/assoc_tests_mac100_gt1_le5.txt &
pseq proj_name assoc --phenotype scz --mask loc.group=refseq mac=1-100 meta.req='1000g2014oct_all':le:0.05 include="ExonicFunc.refGene == 'stopgain' ||  ExonicFunc.refGene == 'stoploss' || ExonicFunc.refGene == 'frameshift_deletion' || ExonicFunc.refGene == 'frameshift_insertion' || ExonicFunc.refGene == 'nonsynonymous_SNV'" --tests burden uniq vt calpha sumstat > assoc_tests/assoc_tests_mac100_le5.txt &

# Run single locus association tests split by gene, set the positions and gene names
#!/bin/bash
# run pseq gene association tests filtering by 1000g frequencies
# position=( chr16:699363..717829 chr12:132380340..132405878 chr15:24921079..24924380 chr4:66189846..66535445 chr7:111368385..111644163 chr2:160585608..160619502 chr3:128339277..128369613 chr5:168093547..168727521 chr6:32010063..32065947 chr18:54339820..54688004 chr14:58894997..59014559 chr14:58909435..58979241 chr1:109837810..109849499 chr17:27282991..27332883 chr11:65658352..65658832 chr4:167921516..168155233 chr3:8794667..8809749 chr22:50656197..50682848 chr9:35842436..35853736 chr9:35698406..35725610 chr3:182733233..182817147 chr11:77907296..77924818 chr10:31133939..31165947 chr2:158177847..158182186 chr12:76750430..76853672 chr4:166300441..166418725 chr11:57885990..57886598 chr11:57885990..57886598 chr16:338122..396853 chr9:136521654..136522226 chr4:167656100..168155233 chr16:452004..461520 chr3:152058344..152058626 chr3:152058344..152058626 chr10:15091693..15115223 chr14:93813628..94173194 chr2:202671494..202755554 chr7:105401850..105429124 chr12:107974697..108051301 chr16:108505..114742 chr18:21269756..21533011 chr18:28574292..28622590 chr2:202671494..202744815 chr15:73614829..73660496 chr1:52703211..52811856 chr14:54416754..54418915 chr1:203734769..203743765 chr11:124735552..124751139 chr11:396656..404556 chr11:93778876..93845011 chr22:50312422..50320942 chr1:204394000..204438908 chr2:166731284..166806158 chr2:202352351..202483844 chr12:4705315..4722822 chr1:52703211..52729487 chr7:4820820..4830979 chr10:27295855..27389253 chr1:220142231..220208305 chr1:150337324..150445767 chr19:55684882..55690437 chr17:12666404..12666860 chr6:28293992..28297346 chr18:214910..267988 chr2:75891841..75933733 chr17:74133640..74136310 chr7:148506185..148544339 chr15:73408896..73593745 chr7:69064650..69583211 chr11:46419010..46569887 chr4:77244541..77317560 chr8:37967917..37996368 chr8:37963081..37996368 chr12:107712824..108051301 chr21:45668937..45681138 chr11:46406715..46408067 chr21:46020539..46067216 chr11:88241800..88780859 chr11:102661211..102668173 chr22:18273592..18389554 chr3:124303696..124438307 chr6:32084259..32095917 chr2:75929362..75937948 chr2:75891841..75937948 chr2:26532951..26539862 chr17:4574745..4607418 chr2:26532404..26539862 chr1:236141234..236228258 chr14:24837530..24846907 chr8:82715340..82752079 chr4:981602..985451 chr4:156618101..156643335 chr1:206809070..206822106 chr7:69064650..70255978 chr4:980879..985451 chr6:169982991..170089092 chr4:77227999..77231074 chr4:77227999..77231074 chr21:45705936..45717567 chr8:146054903..146068520 chr11:47187044..47198383 chr4:159603406..159629676 chr3:130279229..130394240 chr8:22020112..22021510 chr11:86662308..86663443 chr1:8073700..8075618 chr2:202400746..202483844 chr19:50392922..50413058 chr8:38178606..38205397 chr17:76420030..76420229 chr15:67457337..67482855 chr4:78987169..79366891 chr11:86518683..86519823 chr6:26020722..26021109 chr1:192316448..192335121 chr16:812694..818698 chr5:147020344..147040773 chr16:418342..420107 chr4:156618101..156651312 chr2:32449546..32477709 chr9:35842436..35846569 chr1:3547545..3566556 chr3:130733058..130735053 chr8:100899824..100904243 chr11:60531262..60543142 chr3:130733058..130743937 chr3:56655626..56695022 chr11:65343813..65359730 chr21:43496247..43557725 chr14:20691976..20692800 chr19:7505367..7535126 chr18:21453059..21533011 chr14:65216086..65289773 chr9:136337261..136344142 chr1:2121151..2125543 chr7:44663949..44747537 chr22:39760219..39777855 chr1:55271832..55307347 chr4:72205020..72432790 chr2:27444206..27466367 chr1:230883294..230931018 chr7:44663949..44715767 chr9:140063413..140064304 chr1:211526768..211545920 chr18:29078258..29126407 chr11:117073730..117075073 chr14:24838803..24846907 chr7:100486464..100486835 chr4:78987169..79462160 chr9:133884747..133967105 chr11:123777256..123777910 chr19:5894787..5903682 chr10:16867011..17171652 chr6:26458867..26468722 chr3:184098111..184106780 chr14:65233451..65289773 chr2:31558846..31628802 chr10:3180461..3214937 chrX:2825454..2843789 chr20:47863812..47888227 chr14:93022208..93154527 chr14:50235265..50249602 chr3:123987744..124438307 chrX:1522166..1571720 chr1:2125098..2125543 chr3:123987744..124210236 chr11:120979927..121061448 chr15:67477124..67482855 chr21:34876795..34911518 chr19:50411534..50413058 chr20:47838011..47860212 chr12:56625114..56631513 chr4:91229455..91645114 chr8:38250133..38265773 chr2:179391768..179669344 chr11:89867953..89914820 chr4:88533296..88537252 chr4:75858580..75971374 chr22:18324622..18389554 chr14:53326337..53417220 chr1:6685282..6693112 chr1:5923374..6046343 chr18:43432436..43547163 chr11:76853813..76925715 chr12:2786373..2800220 chr8:37720486..37756847 chr19:53905408..53912296 chr17:1370804..1395780 chr17:1370804..1388989 chr4:72121012..72432790 chr8:39442160..39468230 chr14:54976756..55005036 chr16:11846568..11868277 chr11:73748642..73879449 chr8:146278000..146279527 chr15:74536356..74627438 chr7:100319204..100320695 chr22:18347598..18389554 chr19:51656329..51656357 chr12:130883702..130963539 chr3:184090406..184093764 chr5:6633700..6668346 chr18:43204744..43262374 chr2:167055196..167168248 chr21:45432394..45523348 chr14:95030018..95035873 chr5:157053400..157078941 chr14:24422999..24424296 chr12:49884473..49919998 chr11:76853813..76895754 chr11:57093937..57102097 chr8:39442160..39587442 chr16:18823339..18937332 chr11:59282446..59283248 chr3:56655626..56655626 chr1:213224805..213415918 chr8:24242019..24261601 chr14:101193430..101201222 chr11:67071100..67079319 chr1:16577178..16583216 chr8:38134008..38205397 chr17:909328..915979 chr19:36317425..36342568 chr5:133473771..133481969 chr1:33985272..34631386 chr14:105404492..105444535 chr4:69512825..69536329 chr1:205538235..205566977 chr4:71021775..71024603 chr6:51609193..51948009 chr17:79910934..79918613 chr9:130478425..130493577 chr16:49525208..49856594 chr10:21784633..21784863 chr2:219855054..219857896 chr5:93855953..93872747 chrX:2139162..2418915 chrX:2406720..2418915 chr2:207162045..207176150 chr13:113669126..113750944 chrX:2406720..2408435 chr14:104029307..104038107 chr1:182869122..182922114 chr6:136582462..136600997 chr16:855464..863838 chr6:51483929..51948009 chr2:160661605..160761171 chr2:160661605..160761171 chr9:78506189..78808209 chr2:220412279..220414569 chr11:76370682..76372284 chr7:19737951..19748434 chr7:141618730..141619558 chr1:155205008..155210451 chr11:18955412..18956304 chr14:37132490..37145637 chr13:37393677..37399589 chr11:62284251..62302632 chr1:34329853..34330337 chr16:29802115..29816237 chr3:179519756..179615998 chr11:7021149..7022768 chr8:144808167..144812718 chr9:78506189..78973693 chr16:29810016..29816237 chr16:613299..615299 chr2:65296579..65309811 chr3:194362828..194392884 chr19:48551605..48608642 chr7:99725058..99725749 chr19:14491956..14519537 chr1:19166093..19186155 chr1:204167288..204183220 chr1:204372492..204380945 chr1:205882177..205912588  chr1:76384558..76398116 chr10:21783421..21786213 chr11:108253727..108338258 chr11:65808236..65816651 chr11:799179..805250  chr14:95883831..95942173 chr15:77905366..78113242 chr16:2762423..2770552 chr16:610422..615529  chr17:4574679..4607632  chr17:76419778..76573476 chr18:33877659..34360022  chr2:162164786..162268228 chr21:46020497..46022091 chr21:46066331..46067566 chr3:130279178..130395888 chr4:144498561..144621828 chr4:153690506..153700916 chr4:52917497..52963471 chr4:71019904..71032326 chr4:91048684..92523370 chr5:140373..190087 chr5:145894417..145895676 chr5:176022803..176037131 chr5:31799031..32111038 chr7:100032983..100033995 chr7:149473131..149531053 chr7:53103349..53104618  chr8:100890223..100906242 chr8:144798507..144804633 chr8:37791800..37797647 chr8:95892453..95907482 )
# gene=( WDR90 ULK1 NPAP1 EPHA5 DOCK4 MARCH7 RPN1 SLIT3 TNXB WDR7 KIAA0586 KIAA0586 MYBPHL SEZ6 CCDC85B SPOCK3 OXTR TUBGCP6 TMEM8B TLN1 MCCC1 USP35 ZNF438 ERMN OSBPL8 CPE OR9I1 OR9Q1 AXIN1 DBH SPOCK3 DECR2 TMEM14E MBNL1 OLAH UNC79 CDK15 ATXN7L1 BTBD11 RHBDF1 LAMA3 DSC3 CDK15 HCN4 ZFYVE9 BMP4 LAX1 ROBO3 PKP3 HEPHL1 CRELD2 PIK3C2B TTC21B ALS2CR11 DYRK4 ZFYVE9 AP5Z1 ANKRD26 EPRS RPRD2 SYT5 MYOCD ZSCAN31 THOC1 GCFC2 FOXJ1 EZH2 NEO1 AUTS2 AMBRA1 CCDC158 ASH2L ASH2L BTBD11 DNMT3L CHRM4 TSPEAR GRM5 MMP1 MICAL3 KALRN ATF6B GCFC2 GCFC2 GPR113 PELP1 GPR113 NID1 NFATC4 SNX16 SLC26A1 GUCY1A3 DYRK3 AUTS2 IDUA WDR27 FAM47E-STBD1 STBD1 AIRE ZNF7 ARFGAP2 ETFDH COL6A6 SFTPC FZD4 ERRFI1 ALS2CR11 IL4I1 WHSC1L1 PGS1 SMAD3 FRAS1 PRSS23 HIST1H3A RGS21 MSLN JAKMIP2 MRPL28 GUCY1A3 NLRC4 TMEM8B WRAP73 ATP2C1 COX6C MS4A15 ASTE1 FAM208A EHBP1L1 UMODL1 OR11H6 ARHGEF18 LAMA3 SPTB SLC2A6 C1orf86 OGDH SYNGR1 C1orf177 SLC4A4 CAD CAPN9 OGDH LRRC26 TRAF5 DSG2 TAGLN NFATC4 UFSP1 FRAS1 LAMC3 OR8D4 NDUFA11 CUBN BTN2A1 CHRD SPTB XDH PITRM1 ARSD ZNFX1 RIN3 KLHDC2 KALRN ASMTL C1orf86 KALRN TECTA SMAD3 GART NUP62 DDX27 SLC39A5 CCSER1 LETM2 TTN NAALAD2 DSPP PARM1 MICAL3 FERMT2 THAP3 NPHP4 EPG5 MYO7A CACNA1C RAB11FIP1 ZNF765 MYO1C MYO1C SLC4A4 ADAM18 CGRRF1 ZC3H7A C2CD3 C8orf33 CCDC33 EPO MICAL3 SIGLEC7 RIMBP2 THPO SRD5A1 SLC14A2 SCN9A TRAPPC10 SERPINA4 SOX30 DHRS4 SPATS2 MYO7A SSRP1 ADAM18 SMG1 OR4D9 CCDC66 RPS6KC1 ADAMDEC1 DLK1 SSH3 FBXO42 WHSC1L1 ABR NPHS1 TCF7 CSMD2 AHNAK2 UGT2B15 MFSD4 C4orf40 PKHD1 NOTUM TTC16 ZNF423 C10orf114 CRYBA2 KIAA0825 DHRSX ZBED1 ZDBF2 MCF2L ZBED1 APOPT1 SHCBP1L BCLAF1 PRR25 PKHD1 LY75-CD302 LY75 PCSK5 TMEM198 LRRC32 TWISTNB OR9A4 GBA MRGPRX1 PAX9 RFXAP AHNAK HMGB4 KIF22 PEX5L ZNF214 FAM83H PCSK5 KIF22 C16orf11 CEP68 LSG1 PLA2G4C MBLAC1 ADGRE5 TAS1R2 GOLT1A PPP1R15B SLC26A9 ASB17 CASC10 C11orf65 GAL3ST3 PIDD1 SYNE3 LINGO1 PRSS27 PRR35 PELP1 DNAH17 FHOD3 PSMD14 KRTAP10-7 KRTAP10-11 COL6A6 FREM3 TIGD4 SPATA18 PRR27 CCSER1 PLEKHG4B GPR151 GPRIN1 PDZD2 PPP1R35 SSPO POM121L12 COX6C MAPK15 GOT1L1 CCNE2 )

for ((i=0; i < ${#position[@]} && i < ${#gene[@]}; i++))
do
	echo "Processing sample $i..."
	pseq proj_name v-assoc --phenotype scz --mask reg="${position[i]}" mac=1-100 meta.req='1000g2014oct_all':le:0.01 include="ExonicFunc.refGene == 'stopgain' ||  ExonicFunc.refGene == 'stoploss' || ExonicFunc.refGene == 'frameshift_deletion' || ExonicFunc.refGene == 'frameshift_insertion' || ExonicFunc.refGene == 'nonsynonymous_SNV'" --vmeta --show '1000g2014oct_all' SNPEFF_GENE_NAME 'ExonicFunc.refGene' SNPEFF_FUNCTIONAL_CLASS SNPEFF_IMPACT > le_1/"${gene[i]}"_le_1

	pseq proj_name v-assoc --phenotype scz --mask reg="${position[i]}" mac=1-100 meta.req='1000g2014oct_all':gt:0.01,'1000g2014oct_all':le:0.05 include="ExonicFunc.refGene == 'stopgain' ||  ExonicFunc.refGene == 'stoploss' || ExonicFunc.refGene == 'frameshift_deletion' || ExonicFunc.refGene == 'frameshift_insertion' || ExonicFunc.refGene == 'nonsynonymous_SNV'" --vmeta --show '1000g2014oct_all' SNPEFF_GENE_NAME 'ExonicFunc.refGene' SNPEFF_FUNCTIONAL_CLASS SNPEFF_IMPACT > gt1_le5/"${gene[i]}"_gt1le5

	pseq proj_name v-assoc --phenotype scz --mask reg="${position[i]}" mac=1-100 meta.req='1000g2014oct_all':le:0.05 include="ExonicFunc.refGene == 'stopgain' ||  ExonicFunc.refGene == 'stoploss' || ExonicFunc.refGene == 'frameshift_deletion' || ExonicFunc.refGene == 'frameshift_insertion' || ExonicFunc.refGene == 'nonsynonymous_SNV'" --vmeta --show '1000g2014oct_all' SNPEFF_GENE_NAME 'ExonicFunc.refGene' SNPEFF_FUNCTIONAL_CLASS SNPEFF_IMPACT > le_5/"${gene[i]}"_le_5
done


# Read gene files into ipython notebook
